<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>开启二进制日志报  This function has none of DETERMINISTIC, NO SQL, or READS SQL DATA in its declaration and binary logging is enabled - </title>
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#MySql">MySql</a>&nbsp;&#187;&nbsp;开启二进制日志报  This function has none of DETERMINISTIC, NO SQL, or READS SQL DATA in its declaration and binary logging is enabled
    <span class="updated">Page Updated&nbsp;
      2017-06-02 00:00
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">开启二进制日志报  This function has none of DETERMINISTIC, NO SQL, or READS SQL DATA in its declaration and binary logging is enabled</div>

  <h1 id="_1">错误</h1>
<div class="hlcode"><pre><span class="cp">[</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">26</span> <span class="mi">19</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">12</span><span class="cp">]</span> <span class="cp">[</span><span class="nx">http</span><span class="na">-apr</span><span class="o">-</span><span class="mi">8080</span><span class="na">-exec</span><span class="o">-</span><span class="mi">9</span><span class="cp">]</span> <span class="p">(</span><span class="nx">HealthController</span><span class="p">.</span><span class="nx">java</span><span class="o">:</span><span class="mi">78</span><span class="p">)</span> <span class="nx">ERROR</span> <span class="nx">sharejoy</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">action</span><span class="p">.</span><span class="nx">cloudhealth</span><span class="p">.</span><span class="nx">HealthController</span> <span class="o">-</span> <span class="err">血压接口异常：【</span>
<span class="err">###</span> <span class="nb">Error</span> <span class="nx">updating</span> <span class="nx">database</span><span class="p">.</span>  <span class="nx">Cause</span><span class="o">:</span> <span class="nx">java</span><span class="p">.</span><span class="nx">sql</span><span class="p">.</span><span class="nx">SQLException</span><span class="o">:</span> <span class="nx">This</span> <span class="kd">function</span> <span class="nx">has</span> <span class="nx">none</span> <span class="nx">of</span> <span class="nx">DETERMINISTIC</span><span class="p">,</span> <span class="nx">NO</span> <span class="nx">SQL</span><span class="p">,</span> <span class="nx">or</span> <span class="nx">READS</span> <span class="nx">SQL</span> <span class="nx">DATA</span> <span class="k">in</span> <span class="nx">its</span> <span class="nx">declaration</span> <span class="nx">and</span> <span class="nx">binary</span> <span class="nx">logging</span> <span class="nx">is</span> <span class="nx">enabled</span> <span class="p">(</span><span class="nx">you</span> <span class="o">*</span><span class="nx">might</span><span class="o">*</span> <span class="nx">want</span> <span class="nx">to</span> <span class="nx">use</span> <span class="nx">the</span> <span class="nx">less</span> <span class="nx">safe</span> <span class="nx">log_bin_trust_function_creators</span> <span class="nx">variable</span><span class="p">)</span>
<span class="err">###</span> <span class="nx">The</span> <span class="nx">error</span> <span class="nx">may</span> <span class="nx">involve</span> <span class="nx">sharejoy</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">mapper</span><span class="p">.</span><span class="nx">cloudhealth</span><span class="p">.</span><span class="nx">BloodPressureMapper</span><span class="p">.</span><span class="nx">insert</span><span class="o">-</span><span class="nx">Inline</span>
<span class="err">###</span> <span class="nx">The</span> <span class="nx">error</span> <span class="nx">occurred</span> <span class="k">while</span> <span class="nx">setting</span> <span class="nx">parameters</span>
<span class="err">###</span> <span class="nx">SQL</span><span class="o">:</span> <span class="nx">insert</span> <span class="nx">into</span> <span class="nx">db_bloodpressurexx</span> <span class="p">(</span><span class="nx">ID</span><span class="p">,</span> <span class="nx">USER_ID</span><span class="p">,</span> <span class="nx">YYYYMM_CODE</span><span class="p">,</span> <span class="nx">SBP_VAL</span><span class="p">,</span> <span class="nx">DBP_VAL</span><span class="p">,</span> <span class="nx">PULSE_VAL</span><span class="p">,</span>        <span class="nx">DEV_NO</span><span class="p">,</span> <span class="nx">USER_NO</span><span class="p">,</span> <span class="nx">RECEIVE_TIME</span><span class="p">,</span> <span class="nx">CREATE_TIME</span><span class="p">)</span>     <span class="nx">values</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span>        <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span>        <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span>        <span class="nx">now</span><span class="p">())</span>
<span class="err">###</span> <span class="nx">Cause</span><span class="o">:</span> <span class="nx">java</span><span class="p">.</span><span class="nx">sql</span><span class="p">.</span><span class="nx">SQLException</span><span class="o">:</span> <span class="nx">This</span> <span class="kd">function</span> <span class="nx">has</span> <span class="nx">none</span> <span class="nx">of</span> <span class="nx">DETERMINISTIC</span><span class="p">,</span> <span class="nx">NO</span> <span class="nx">SQL</span><span class="p">,</span> <span class="nx">or</span> <span class="nx">READS</span> <span class="nx">SQL</span> <span class="nx">DATA</span> <span class="k">in</span> <span class="nx">its</span> <span class="nx">declaration</span> <span class="nx">and</span> <span class="nx">binary</span> <span class="nx">logging</span> <span class="nx">is</span> <span class="nx">enabled</span> <span class="p">(</span><span class="nx">you</span> <span class="o">*</span><span class="nx">might</span><span class="o">*</span> <span class="nx">want</span> <span class="nx">to</span> <span class="nx">use</span> <span class="nx">the</span> <span class="nx">less</span> <span class="nx">safe</span> <span class="nx">log_bin_trust_function_creators</span> <span class="nx">variable</span><span class="p">)</span>
<span class="p">;</span> <span class="nx">uncategorized</span> <span class="nx">SQLException</span> <span class="k">for</span> <span class="nx">SQL</span> <span class="cp">[]</span><span class="p">;</span> <span class="nx">SQL</span> <span class="nx">state</span> <span class="cp">[</span><span class="nx">HY000</span><span class="cp">]</span><span class="p">;</span> <span class="nx">error</span> <span class="nx">code</span> <span class="cp">[</span><span class="mi">1418</span><span class="cp">]</span><span class="p">;</span> <span class="nx">This</span> <span class="kd">function</span> <span class="nx">has</span> <span class="nx">none</span> <span class="nx">of</span> <span class="nx">DETERMINISTIC</span><span class="p">,</span> <span class="nx">NO</span> <span class="nx">SQL</span><span class="p">,</span> <span class="nx">or</span> <span class="nx">READS</span> <span class="nx">SQL</span> <span class="nx">DATA</span> <span class="k">in</span> <span class="nx">its</span> <span class="nx">declaration</span> <span class="nx">and</span> <span class="nx">binary</span> <span class="nx">logging</span> <span class="nx">is</span> <span class="nx">enabled</span> <span class="p">(</span><span class="nx">you</span> <span class="o">*</span><span class="nx">might</span><span class="o">*</span> <span class="nx">want</span> <span class="nx">to</span> <span class="nx">use</span> <span class="nx">the</span> <span class="nx">less</span> <span class="nx">safe</span> <span class="nx">log_bin_trust_function_creators</span> <span class="nx">variable</span><span class="p">);</span> <span class="nx">nested</span> <span class="nx">exception</span> <span class="nx">is</span> <span class="nx">java</span><span class="p">.</span><span class="nx">sql</span><span class="p">.</span><span class="nx">SQLException</span><span class="o">:</span> <span class="nx">This</span> <span class="kd">function</span> <span class="nx">has</span> <span class="nx">none</span> <span class="nx">of</span> <span class="nx">DETERMINISTIC</span><span class="p">,</span> <span class="nx">NO</span> <span class="nx">SQL</span><span class="p">,</span> <span class="nx">or</span> <span class="nx">READS</span> <span class="nx">SQL</span> <span class="nx">DATA</span> <span class="k">in</span> <span class="nx">its</span> <span class="nx">declaration</span> <span class="nx">and</span> <span class="nx">binary</span> <span class="nx">logging</span> <span class="nx">is</span> <span class="nx">enabled</span> <span class="p">(</span><span class="nx">you</span> <span class="o">*</span><span class="nx">might</span><span class="o">*</span> <span class="nx">want</span> <span class="nx">to</span> <span class="nx">use</span> <span class="nx">the</span> <span class="nx">less</span> <span class="nx">safe</span> <span class="nx">log_bin_trust_function_creators</span> <span class="nx">variable</span><span class="p">)</span><span class="err">】</span>
</pre></div>


<h1 id="_2">原因</h1>
<p><em>开启了mysql的二进制日志</em></p>
<div class="hlcode"><pre><span class="n">log</span><span class="o">-</span><span class="n">bin</span><span class="o">=</span><span class="n">mysql</span><span class="o">-</span><span class="n">bin</span>
<span class="n">binlog</span><span class="o">-</span><span class="n">ignore</span><span class="o">-</span><span class="n">db</span> <span class="o">=</span> <span class="n">mysql</span>
<span class="n">binlog</span><span class="o">-</span><span class="n">ignore</span><span class="o">-</span><span class="n">db</span> <span class="o">=</span> <span class="n">test</span>
<span class="n">binlog</span><span class="o">-</span><span class="n">ignore</span><span class="o">-</span><span class="n">db</span> <span class="o">=</span> <span class="n">performance_schema</span>
</pre></div>


<h1 id="_3">解决办法</h1>
<ol>
<li>
<p>执行如下语句</p>
<p>SET GLOBAL log_bin_trust_function_creators = 1;</p>
</li>
<li>
<p>修改mysql.ini配置文件，重启服务</p>
<p>log_bin_trust_function_creators = 1</p>
</li>
</ol>
<h1 id="_4">说明</h1>
<p>参考：<a href="https://dev.mysql.com/doc/refman/5.7/en/stored-programs-logging.html">Binary Logging of Stored Programs</a></p>
<blockquote>
<p>当创建存储过程、函数或触发器的时候，必须声明，要么是确定的或者它不会修改数据。否则，它可能是不安全的数据恢复或复制。</p>
<p>默认情况下，在CREATE FUNCTION、TRIGGER、PRODUCE语句被使用时，Deterministic，NO SQL或READS SQL DATA必须被明确指定至少一个。否则会出现错误 </p>
</blockquote>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2017 .
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2017-07-24 14:48:39</p>
      </span>
    </div>

    
    
  </body>
</html>